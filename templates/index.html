<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Control Panel - Terminator</title>
    
    <!-- xterm.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links@0.9.0/lib/xterm-addon-web-links.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header__brand">
            <h1 class="header__logo">
                <span class="header__logo-icon">‚å®Ô∏è</span>
                Terminal Control Panel
                <span style="font-size: 0.65rem; color: var(--accent-orange); margin-left: 8px; font-weight: 400;">TERMINATOR</span>
            </h1>
        </div>
        
        <div class="header__config">
            <div class="config-field">
                <label class="config-field__label">Prefix</label>
                <input type="text" id="prefixInput" class="config-field__input" value="term-" title="Session name prefix" style="width: 80px;">
            </div>
        </div>
        
        <div class="header__status">
            <span class="status-dot" id="statusDot"></span>
            <span id="statusText">Disconnected</span>
        </div>
    </header>
    
    <!-- Main Layout -->
    <div class="main">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Sessions Section -->
            <div class="sidebar__section">
                <div class="sidebar__header">
                    <span class="sidebar__title">Sessions</span>
                    <button class="btn btn--primary btn--sm" onclick="showModal('newSessionModal')">+ New</button>
                </div>
                <div class="sidebar__content">
                    <div class="session-list" id="sessionList">
                        <div class="empty-message">No sessions</div>
                    </div>
                </div>
            </div>
            
            <!-- Displays Section -->
            <div class="sidebar__section">
                <div class="sidebar__header">
                    <span class="sidebar__title">X11 Displays</span>
                    <button class="btn btn--success btn--sm" onclick="showModal('newDisplayModal')">+ New</button>
                </div>
                <div class="sidebar__content">
                    <div class="display-list" id="displayList">
                        <div class="empty-message">No displays</div>
                    </div>
                </div>
            </div>
            
            <!-- Tips -->
            <div class="sidebar__section" style="padding: 12px;">
                <details class="tips-panel">
                    <summary class="tips-panel__toggle">üí° GUI Tips</summary>
                    <div class="tips-panel__content tips-panel__content--visible">
                        <div class="tips-panel__item">
                            <strong>1.</strong> Create a display (e.g., :99)
                        </div>
                        <div class="tips-panel__item">
                            <strong>2.</strong> Connect GUI panel to display
                        </div>
                        <div class="tips-panel__item">
                            <strong>3.</strong> In terminal, run:<br>
                            <code>export DISPLAY=:99</code>
                        </div>
                        <div class="tips-panel__item">
                            <strong>4.</strong> Launch app: <code>xeyes &</code>
                        </div>
                        <div class="tips-panel__item" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-primary);">
                            <strong>Or:</strong> Use "Bind" on GUI panel header
                        </div>
                    </div>
                </details>
            </div>
        </aside>
        
        <!-- Workspace -->
        <main class="workspace" id="workspace">
            <!-- Toolbar -->
            <div class="workspace__toolbar">
                <div class="layout-controls">
                    <span class="layout-controls__label">Layout</span>
                    <button class="layout-btn layout-btn--active" data-layout="terminals-only" title="Terminals Only">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                        </svg>
                    </button>
                    <button class="layout-btn" data-layout="split-1" title="Terminal + 1 GUI">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <line x1="12" y1="3" x2="12" y2="21"/>
                        </svg>
                    </button>
                    <button class="layout-btn" data-layout="split-2" title="Terminal + 2 GUI">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <line x1="9" y1="3" x2="9" y2="21"/>
                            <line x1="15" y1="3" x2="15" y2="21"/>
                        </svg>
                    </button>
                    <button class="layout-btn" data-layout="split-3" title="Terminal + 3 GUI">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <line x1="12" y1="3" x2="12" y2="21"/>
                            <line x1="12" y1="12" x2="21" y2="12"/>
                        </svg>
                    </button>
                </div>
                
                <div style="display: flex; gap: 8px;">
                    <button class="btn btn--secondary btn--sm" onclick="refreshSessions()">‚Üª Refresh</button>
                </div>
            </div>
            
            <!-- Workspace Content -->
            <div class="workspace__content workspace__content--terminals-only" id="workspaceContent">
                <!-- Terminal Panel (left side) -->
                <div class="terminal-panel" id="terminalPanel">
                    <div class="terminal-panel__header">
                        <span class="terminal-panel__title" id="terminalTitle">No session selected</span>
                        <div class="terminal-panel__controls">
                            <button class="btn btn--secondary btn--sm" onclick="sendSignal('SIGINT')" title="Ctrl+C">‚èπ Stop</button>
                            <button class="btn btn--secondary btn--sm" onclick="sendSignal('SIGTSTP')" title="Ctrl+Z">‚è∏ Suspend</button>
                            <button class="btn btn--secondary btn--sm" onclick="clearTerminal()">üîÑ Clear</button>
                            <button class="btn btn--danger btn--sm" onclick="deleteSession(state.currentSession)" id="deleteSessionBtn">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="terminal-panel__body" id="terminalBody">
                        <div class="terminal-panel__placeholder" id="terminalPlaceholder">
                            <div class="terminal-panel__placeholder-icon">‚å®Ô∏è</div>
                            <div class="terminal-panel__placeholder-text">Select or create a session</div>
                        </div>
                        <div id="terminalContainer" style="display: none; width: 100%; height: 100%;"></div>
                    </div>
                    <div class="quick-commands" id="quickCommands">
                        <span class="quick-commands__label">Quick:</span>
                        <button class="btn btn--secondary btn--sm" onclick="showModal('addCommandModal')">+ Add</button>
                    </div>
                </div>
                
                <!-- Main Resizer (between Terminal and GUI container) -->
                <div class="resizer resizer--horizontal" id="mainResizer" style="display: none;"></div>
                
                <!-- GUI Container (right side, stacks vertically) -->
                <div class="gui-container" id="guiContainer" style="display: none;">
                    <!-- GUI Panel 1 -->
                    <div class="gui-panel gui-panel--hidden" id="guiPanel1">
                        <div class="gui-panel__header">
                            <span class="gui-panel__title">
                                üñºÔ∏è GUI 1 <span class="gui-panel__display-num">Not connected</span>
                            </span>
                            <div class="gui-panel__controls">
                                <button class="btn btn--primary btn--sm" onclick="showConnectDisplayModal(0)">Connect</button>
                                <button class="btn btn--secondary btn--sm" onclick="bindDisplayToSession(state.guiPanels[0].displayNum)" title="Set DISPLAY in terminal">Bind</button>
                                <button class="btn btn--secondary btn--sm" onclick="toggleFullscreen(0)" title="Fullscreen">‚õ∂</button>
                                <button class="btn btn--secondary btn--sm" onclick="toggleDetach(0)" title="Detach/Pop-out">‚ßâ</button>
                                <button class="btn btn--danger btn--sm" onclick="disconnectGuiPanel(0)">√ó</button>
                            </div>
                        </div>
                        <div class="gui-panel__body">
                            <div class="gui-panel__placeholder">
                                <div class="gui-panel__placeholder-icon">üñºÔ∏è</div>
                                <div class="gui-panel__placeholder-text">Click "Connect" to attach a display</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resizer between GUI 1 and GUI 2 -->
                    <div class="resizer resizer--vertical gui-resizer" data-index="0" style="display: none;"></div>
                    
                    <!-- GUI Panel 2 -->
                    <div class="gui-panel gui-panel--hidden" id="guiPanel2">
                        <div class="gui-panel__header">
                            <span class="gui-panel__title">
                                üñºÔ∏è GUI 2 <span class="gui-panel__display-num">Not connected</span>
                            </span>
                            <div class="gui-panel__controls">
                                <button class="btn btn--primary btn--sm" onclick="showConnectDisplayModal(1)">Connect</button>
                                <button class="btn btn--secondary btn--sm" onclick="bindDisplayToSession(state.guiPanels[1].displayNum)" title="Set DISPLAY in terminal">Bind</button>
                                <button class="btn btn--secondary btn--sm" onclick="toggleFullscreen(1)" title="Fullscreen">‚õ∂</button>
                                <button class="btn btn--secondary btn--sm" onclick="toggleDetach(1)" title="Detach/Pop-out">‚ßâ</button>
                                <button class="btn btn--danger btn--sm" onclick="disconnectGuiPanel(1)">√ó</button>
                            </div>
                        </div>
                        <div class="gui-panel__body">
                            <div class="gui-panel__placeholder">
                                <div class="gui-panel__placeholder-icon">üñºÔ∏è</div>
                                <div class="gui-panel__placeholder-text">Click "Connect" to attach a display</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resizer between GUI 2 and GUI 3 -->
                    <div class="resizer resizer--vertical gui-resizer" data-index="1" style="display: none;"></div>
                    
                    <!-- GUI Panel 3 -->
                    <div class="gui-panel gui-panel--hidden" id="guiPanel3">
                        <div class="gui-panel__header">
                            <span class="gui-panel__title">
                                üñºÔ∏è GUI 3 <span class="gui-panel__display-num">Not connected</span>
                            </span>
                            <div class="gui-panel__controls">
                                <button class="btn btn--primary btn--sm" onclick="showConnectDisplayModal(2)">Connect</button>
                                <button class="btn btn--secondary btn--sm" onclick="bindDisplayToSession(state.guiPanels[2].displayNum)" title="Set DISPLAY in terminal">Bind</button>
                                <button class="btn btn--secondary btn--sm" onclick="toggleFullscreen(2)" title="Fullscreen">‚õ∂</button>
                                <button class="btn btn--secondary btn--sm" onclick="toggleDetach(2)" title="Detach/Pop-out">‚ßâ</button>
                                <button class="btn btn--danger btn--sm" onclick="disconnectGuiPanel(2)">√ó</button>
                            </div>
                        </div>
                        <div class="gui-panel__body">
                            <div class="gui-panel__placeholder">
                                <div class="gui-panel__placeholder-icon">üñºÔ∏è</div>
                                <div class="gui-panel__placeholder-text">Click "Connect" to attach a display</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Fullscreen Overlay -->
    <div class="fullscreen-overlay" id="fullscreenOverlay"></div>
    
    <!-- New Session Modal -->
    <div class="modal-overlay" id="newSessionModal">
        <div class="modal">
            <h3 class="modal__title">Create New Session</h3>
            <div class="form-group">
                <label class="form-group__label" for="sessionName">Session Name</label>
                <input type="text" id="sessionName" class="form-group__input" placeholder="my-session" autocomplete="off">
                <span class="form-group__hint">Alphanumeric and hyphens only</span>
            </div>
            <div class="form-group">
                <label class="form-group__label" for="sessionCwd">Working Directory</label>
                <input type="text" id="sessionCwd" class="form-group__input" placeholder="/home/user/project">
                <span class="form-group__hint">Optional</span>
            </div>
            <div class="form-group">
                <label class="form-group__label" for="sessionCmd">Initial Command</label>
                <input type="text" id="sessionCmd" class="form-group__input" placeholder="npm run dev">
                <span class="form-group__hint">Optional</span>
            </div>
            <div class="modal__actions">
                <button class="btn btn--secondary" onclick="hideModal('newSessionModal')">Cancel</button>
                <button class="btn btn--primary" onclick="createSession()">Create</button>
            </div>
        </div>
    </div>
    
    <!-- New Display Modal -->
    <div class="modal-overlay" id="newDisplayModal">
        <div class="modal">
            <h3 class="modal__title">Create X11 Display</h3>
            <div class="form-group">
                <label class="form-group__label" for="displayNum">Display Number</label>
                <input type="number" id="displayNum" class="form-group__input" placeholder="99" min="1" max="199">
                <span class="form-group__hint">e.g., 99 for :99 (leave empty for auto)</span>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-group__label" for="displayWidth">Width</label>
                    <input type="number" id="displayWidth" class="form-group__input" value="1280" min="640" max="3840">
                </div>
                <div class="form-group">
                    <label class="form-group__label" for="displayHeight">Height</label>
                    <input type="number" id="displayHeight" class="form-group__input" value="800" min="480" max="2160">
                </div>
            </div>
            <div class="modal__actions">
                <button class="btn btn--secondary" onclick="hideModal('newDisplayModal')">Cancel</button>
                <button class="btn btn--success" onclick="createDisplay()">Create</button>
            </div>
        </div>
    </div>
    
    <!-- Add Command Modal -->
    <div class="modal-overlay" id="addCommandModal">
        <div class="modal">
            <h3 class="modal__title">Add Quick Command</h3>
            <div class="form-group">
                <label class="form-group__label" for="cmdLabel">Button Label</label>
                <input type="text" id="cmdLabel" class="form-group__input" placeholder="Build" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-group__label" for="cmdCommand">Command</label>
                <input type="text" id="cmdCommand" class="form-group__input" placeholder="npm run build">
            </div>
            <div class="modal__actions">
                <button class="btn btn--secondary" onclick="hideModal('addCommandModal')">Cancel</button>
                <button class="btn btn--primary" onclick="addCommand()">Add</button>
            </div>
        </div>
    </div>
    
    <!-- Connect Display Modal -->
    <div class="modal-overlay" id="bindDisplayModal">
        <div class="modal">
            <h3 class="modal__title">Connect to Display</h3>
            <div class="form-group">
                <label class="form-group__label" for="connectDisplaySelect">Select Display</label>
                <select id="connectDisplaySelect" class="form-group__input">
                    <option disabled>No displays available</option>
                </select>
                <span class="form-group__hint">Create a display first if none available</span>
            </div>
            <div class="modal__actions">
                <button class="btn btn--secondary" onclick="hideModal('bindDisplayModal')">Cancel</button>
                <button class="btn btn--primary" onclick="connectSelectedDisplay()">Connect</button>
            </div>
        </div>
    </div>
    
    <!-- Application Script -->
    <script src="/static/js/app.js"></script>
</body>
</html>